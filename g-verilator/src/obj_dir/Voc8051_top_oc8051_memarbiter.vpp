`begin_keywords "1800-2012"
`line 1 "oc8051_memarbiter.v" 1


`line 9 "oc8051_memarbiter.v" 0

`line 9 "oc8051_memarbiter.v" 0

`line 9 "oc8051_memarbiter.v" 0

`line 9 "oc8051_memarbiter.v" 0

`line 9 "oc8051_memarbiter.v" 0

`line 9 "oc8051_memarbiter.v" 0

`line 9 "oc8051_memarbiter.v" 0
 

`line 11 "oc8051_memarbiter.v" 0
 
 
`line 12 "oc8051_memarbiter.v" 0
`line 1 "oc8051_timescale.v" 1

`line 3 "oc8051_timescale.v" 0

`line 3 "oc8051_timescale.v" 0
`timescale 1ns/10ps

`line 5 "oc8051_timescale.v" 2
`line 12 "oc8051_memarbiter.v" 0

`line 13 "oc8051_memarbiter.v" 0
 

`line 15 "oc8051_memarbiter.v" 0
module oc8051_memarbiter8(
    clk, 
    rst, 
    selected_port,
     
    stb_A,
    wr_A, 
    ack_A,
    addr_A, 
    data_in_A, 
    data_out_A,
     
    stb_B,
    wr_B, 
    ack_B,
    addr_B, 
    data_in_B, 
    data_out_B,
     
    stb_C,
    wr_C,
    ack_C,
    addr_C,
    data_in_C,
    data_out_C,
     
    stb_D,
    wr_D,
    ack_D,
    addr_D,
    data_in_D,
    data_out_D,
     
    stb_E,
    wr_E,
    ack_E,
    addr_E,
    data_in_E,
    data_out_E,
     
    stb,
    wr,
    ack,
    addr,
    data_in,
    data_out
);
input            clk;
input            rst;

`line 65 "oc8051_memarbiter.v" 0
 
input            stb_A;
output           ack_A;
input            wr_A;
input [15:0]     addr_A;
input [7:0]      data_in_A;
output [7:0]     data_out_A;

`line 73 "oc8051_memarbiter.v" 0
 
input            stb_B;
output           ack_B;
input            wr_B;
input [15:0]     addr_B;
input [7:0]      data_in_B;
output [7:0]     data_out_B;

`line 81 "oc8051_memarbiter.v" 0
 
input            stb_C;
output           ack_C;
input            wr_C;
input [15:0]     addr_C;
input [7:0]      data_in_C;
output [7:0]     data_out_C;

`line 89 "oc8051_memarbiter.v" 0
 
input            stb_D;
output           ack_D;
input            wr_D;
input [15:0]     addr_D;
input [7:0]      data_in_D;
output [7:0]     data_out_D;

`line 97 "oc8051_memarbiter.v" 0
 
input            stb_E;
output           ack_E;
input            wr_E;
input [15:0]     addr_E;
input [7:0]      data_in_E;
output [7:0]     data_out_E;

`line 105 "oc8051_memarbiter.v" 0
 
output           stb;
output           wr;
input            ack;
output [15:0]    addr;
output [7:0]     data_in;
input [7:0]      data_out;

`line 113 "oc8051_memarbiter.v" 0
localparam PORT_A = 3'd0;
localparam PORT_B = 3'd1;
localparam PORT_C = 3'd2;
localparam PORT_D = 3'd3;
localparam PORT_E = 3'd4;

`line 119 "oc8051_memarbiter.v" 0
output wire [2:0] selected_port;

`line 121 "oc8051_memarbiter.v" 0
 
reg arbiter_state;      
reg [2:0] arbit_holder;

`line 125 "oc8051_memarbiter.v" 0
 
wire stb        = selected_port == PORT_A ? stb_A     : 
                  selected_port == PORT_B ? stb_B     :
                  selected_port == PORT_C ? stb_C     : 
                  selected_port == PORT_D ? stb_D     : stb_E;

`line 131 "oc8051_memarbiter.v" 0
wire wr         = selected_port == PORT_A ? wr_A      : 
                  selected_port == PORT_B ? wr_B      :
                  selected_port == PORT_C ? wr_C      :
                  selected_port == PORT_D ? wr_D      : wr_E;

`line 136 "oc8051_memarbiter.v" 0
wire [15:0] addr = selected_port == PORT_A ? addr_A    :
                   selected_port == PORT_B ? addr_B    :
                   selected_port == PORT_C ? addr_C    : 
                   selected_port == PORT_D ? addr_D    : addr_E;

`line 141 "oc8051_memarbiter.v" 0
wire [7:0] data_in = selected_port == PORT_A ? data_in_A : 
                     selected_port == PORT_B ? data_in_B :
                     selected_port == PORT_C ? data_in_C : 
                     selected_port == PORT_D ? data_in_D : data_in_E;

`line 146 "oc8051_memarbiter.v" 0
wire ack_A      = selected_port == PORT_A ? ack : 1'b0;
wire ack_B      = selected_port == PORT_B ? ack : 1'b0;
wire ack_C      = selected_port == PORT_C ? ack : 1'b0;
wire ack_D      = selected_port == PORT_D ? ack : 1'b0;
wire ack_E      = selected_port == PORT_E ? ack : 1'b0;

`line 152 "oc8051_memarbiter.v" 0
wire [7:0] data_out_A = data_out;
wire [7:0] data_out_B = data_out;
wire [7:0] data_out_C = data_out;
wire [7:0] data_out_D = data_out;
wire [7:0] data_out_E = data_out;

`line 158 "oc8051_memarbiter.v" 0
 
localparam STATE_INUSE = 1'd1;
localparam STATE_IDLE  = 1'd0;

`line 162 "oc8051_memarbiter.v" 0
 
 
wire arbiter_state_inuse_next = ack ? STATE_IDLE : STATE_INUSE;

`line 166 "oc8051_memarbiter.v" 0
 
wire arbiter_state_idle_next  = 
        ((stb_A || stb_B || stb_C || stb_D || stb_E) && !ack) ? STATE_INUSE : STATE_IDLE;
 
wire arbiter_state_next = 
        (arbiter_state == STATE_IDLE)  ? arbiter_state_idle_next  :
        (arbiter_state == STATE_INUSE) ? arbiter_state_inuse_next : 1'bX;

`line 174 "oc8051_memarbiter.v" 0
 
 
wire arbit_select_winner = (arbiter_state == STATE_IDLE) && (arbiter_state_next == STATE_INUSE);

`line 178 "oc8051_memarbiter.v" 0
 
wire [2:0] arbit_winner = (!stb_A && !stb_B && !stb_C && !stb_D && stb_E) ? PORT_E :
                          (!stb_A && !stb_B && !stb_C && stb_D)           ? PORT_D :
                          (!stb_A && !stb_B && stb_C)                     ? PORT_C :
                          (!stb_A && stb_B)                               ? PORT_B : PORT_A;
                    
 
wire [2:0] arbit_holder_next = arbit_select_winner ? arbit_winner : arbit_holder;

`line 187 "oc8051_memarbiter.v" 0
 
 
assign selected_port = (arbiter_state == STATE_IDLE) ? arbit_winner : arbit_holder;

`line 191 "oc8051_memarbiter.v" 0
always @(posedge clk)
begin
    if (rst) begin
        arbiter_state       <= STATE_IDLE;
        arbit_holder        <= PORT_A;
    end
    else begin
        arbiter_state       <= arbiter_state_next;
        arbit_holder        <= arbit_holder_next;
    end
end
endmodule

`line 204 "oc8051_memarbiter.v" 2
