`begin_keywords "1800-2012"
`line 1 "oc8051_sfr.v" 1
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 

`line 44 "oc8051_sfr.v" 0
 

`line 46 "oc8051_sfr.v" 0
 
 
 

`line 50 "oc8051_sfr.v" 0
 
 

`line 53 "oc8051_sfr.v" 0
 
 

`line 56 "oc8051_sfr.v" 0
 
 

`line 59 "oc8051_sfr.v" 0
 
 

`line 62 "oc8051_sfr.v" 0
 
 

`line 65 "oc8051_sfr.v" 0
 
 

`line 68 "oc8051_sfr.v" 0
 
 

`line 71 "oc8051_sfr.v" 0
 
 

`line 74 "oc8051_sfr.v" 0
 
 

`line 77 "oc8051_sfr.v" 0
 
 

`line 80 "oc8051_sfr.v" 0
 
 

`line 83 "oc8051_sfr.v" 0
 
 

`line 86 "oc8051_sfr.v" 0
 
 



`line 91 "oc8051_sfr.v" 0
 
 
`line 92 "oc8051_sfr.v" 0
`line 1 "oc8051_timescale.v" 1

`line 3 "oc8051_timescale.v" 0

`line 3 "oc8051_timescale.v" 0
`timescale 1ns/10ps

`line 5 "oc8051_timescale.v" 2
`line 92 "oc8051_sfr.v" 0

`line 93 "oc8051_sfr.v" 0
 

`line 95 "oc8051_sfr.v" 0
 
`line 95 "oc8051_sfr.v" 0
`line 1 "oc8051_defines.v" 1
 
`line 2 "oc8051_defines.v" 0
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 

`line 45 "oc8051_defines.v" 0
 



`line 49 "oc8051_defines.v" 0
 

`line 51 "oc8051_defines.v" 0
 
 
 
 
 
 
 
 
 



`line 63 "oc8051_defines.v" 0
 

`line 65 "oc8051_defines.v" 0
 



`line 69 "oc8051_defines.v" 0
 

`line 71 "oc8051_defines.v" 0
 
 
 
 
 


`line 78 "oc8051_defines.v" 0
 

`line 80 "oc8051_defines.v" 0
 
 


`line 84 "oc8051_defines.v" 0
 



`line 88 "oc8051_defines.v" 0
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 


`line 106 "oc8051_defines.v" 0
 


`line 109 "oc8051_defines.v" 0
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 

`line 127 "oc8051_defines.v" 0
 
 
 
 

`line 132 "oc8051_defines.v" 0
 
 



`line 137 "oc8051_defines.v" 0
 
 

`line 140 "oc8051_defines.v" 0
 
 

`line 143 "oc8051_defines.v" 0
 
 
 

`line 147 "oc8051_defines.v" 0
 
 




`line 153 "oc8051_defines.v" 0
 

`line 155 "oc8051_defines.v" 0
 
 
 
 
 
 
 
 
 
 
 
 



`line 170 "oc8051_defines.v" 0
 

`line 172 "oc8051_defines.v" 0
 
 
 
 
 


`line 179 "oc8051_defines.v" 0
 


`line 182 "oc8051_defines.v" 0
 
 
 

`line 186 "oc8051_defines.v" 0
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 

`line 204 "oc8051_defines.v" 0
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 

`line 224 "oc8051_defines.v" 0
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 


`line 304 "oc8051_defines.v" 0
 

`line 306 "oc8051_defines.v" 0
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 



`line 331 "oc8051_defines.v" 0
 
 

`line 334 "oc8051_defines.v" 0
 
 
 
 



`line 341 "oc8051_defines.v" 0
 

`line 343 "oc8051_defines.v" 0
 
 
 
 
 
 
 
 


`line 353 "oc8051_defines.v" 0
 

`line 355 "oc8051_defines.v" 0
 
 
 
 

`line 360 "oc8051_defines.v" 0
 


`line 363 "oc8051_defines.v" 0
 

`line 365 "oc8051_defines.v" 0
 
 
 
 



`line 372 "oc8051_defines.v" 0
 

`line 374 "oc8051_defines.v" 0
 
 
 
 



`line 381 "oc8051_defines.v" 0
 


`line 384 "oc8051_defines.v" 0
 
 
 
 

`line 389 "oc8051_defines.v" 0
 
 
 
 

`line 394 "oc8051_defines.v" 0
 


`line 397 "oc8051_defines.v" 0
 


`line 400 "oc8051_defines.v" 0
 
 
 
 
 
 
 
 


`line 410 "oc8051_defines.v" 0
 

`line 412 "oc8051_defines.v" 0
 
 
 
 
 
 
 
 
 


`line 423 "oc8051_defines.v" 0
 

`line 425 "oc8051_defines.v" 0
 
 
 
 
 



`line 433 "oc8051_defines.v" 0
 

`line 435 "oc8051_defines.v" 0
 
 


`line 439 "oc8051_defines.v" 0
 

`line 441 "oc8051_defines.v" 0
 
 
 
 


`line 447 "oc8051_defines.v" 0
 

`line 449 "oc8051_defines.v" 0
 
 

`line 452 "oc8051_defines.v" 0
 
 
 
 
 



`line 460 "oc8051_defines.v" 0
 

`line 462 "oc8051_defines.v" 0
 
 
 
 
 
 


`line 470 "oc8051_defines.v" 0
 


`line 473 "oc8051_defines.v" 0
 


`line 476 "oc8051_defines.v" 0
 
 
 
 



`line 483 "oc8051_defines.v" 0
 


`line 486 "oc8051_defines.v" 0
 
 
 
 
 
 



`line 495 "oc8051_defines.v" 0
 


`line 498 "oc8051_defines.v" 0
 
 


`line 502 "oc8051_defines.v" 0
 

`line 504 "oc8051_defines.v" 0
 
 
 
 
 
 
 




`line 515 "oc8051_defines.v" 0
 


`line 518 "oc8051_defines.v" 0
 
 


`line 522 "oc8051_defines.v" 0
 

`line 524 "oc8051_defines.v" 0
 
 


`line 528 "oc8051_defines.v" 0
 


`line 531 "oc8051_defines.v" 0
 
 


`line 535 "oc8051_defines.v" 2
`line 95 "oc8051_sfr.v" 0



`line 98 "oc8051_sfr.v" 0
module oc8051_sfr (rst, clk,
       adr0, adr1, dat0, 
       dat1, dat2, bit_in,
       des_acc,
       we, wr_bit,
       bit_out,
       wr_sfr, acc, b_reg,
       ram_wr_sel, ram_rd_sel, 
       sp, sp_w, 
       bank_sel, 
       desAc, desOv,
       srcAc, cy,
       psw_set, rmw,
       comp_sel,
       comp_wait,
       psw,
       p,
       etr,
       priv_lvl,

`line 118 "oc8051_sfr.v" 0
 

`line 120 "oc8051_sfr.v" 0
   
       p0_out,
       p0_in,
  

`line 125 "oc8051_sfr.v" 0
   
       p1_out,
       p1_in,
  

`line 130 "oc8051_sfr.v" 0
   
       p2_out,
       p2_in,
  

`line 135 "oc8051_sfr.v" 0
   
       p3_out,
       p3_in,
  




`line 143 "oc8051_sfr.v" 0
   
        
  

`line 147 "oc8051_sfr.v" 0
       int_ack, intr,
       int0, int1,
       int_src,
       reti,

`line 152 "oc8051_sfr.v" 0
   
        
  

`line 156 "oc8051_sfr.v" 0
   
        
  
        ie,

`line 161 "oc8051_sfr.v" 0
       dptr_hi, dptr_lo,
       wait_data);


`line 165 "oc8051_sfr.v" 0
input       rst,	 
	    clk,	 
            we,		 
	    bit_in,
	    desAc,
	    desOv,
	    rmw;
input       int_ack,
            int0,
	    int1,
            reti,
	    wr_bit;
input [1:0] psw_set,
            wr_sfr,
	    comp_sel;
input [2:0] ram_rd_sel,
            ram_wr_sel;
input [7:0] adr0, 	 
            adr1, 	 
	    des_acc,
	    dat1,	 
            dat2;	 

`line 188 "oc8051_sfr.v" 0
output       bit_out,
             intr,
             srcAc,
	     cy,
	     wait_data,
	     comp_wait;
output [1:0] bank_sel;
output [7:0] dat0,	 
	     int_src,
	     dptr_hi,
	     dptr_lo,
	     acc,
             b_reg,
             psw; 
output       p;
output [7:0] sp,
             sp_w;

`line 206 "oc8051_sfr.v" 0
output [15:0] etr;
input priv_lvl;

`line 209 "oc8051_sfr.v" 0
 
 

`line 212 "oc8051_sfr.v" 0
 
input  [7:0] p0_in;
output [7:0] p0_out;
wire   [7:0] p0_data;


`line 218 "oc8051_sfr.v" 0
 
input  [7:0] p1_in;
output [7:0] p1_out;
wire   [7:0] p1_data;


`line 224 "oc8051_sfr.v" 0
 
input  [7:0] p2_in;
output [7:0] p2_out;
wire   [7:0] p2_data;


`line 230 "oc8051_sfr.v" 0
 
input  [7:0] p3_in;
output [7:0] p3_out;
wire   [7:0] p3_data;




`line 238 "oc8051_sfr.v" 0
output [7:0] ie;

`line 240 "oc8051_sfr.v" 0
 
 
        
       


`line 246 "oc8051_sfr.v" 0
 
 
	      


`line 251 "oc8051_sfr.v" 0
 
 
	      


`line 256 "oc8051_sfr.v" 0
reg        bit_out, 
           wait_data;
reg [7:0]  dat0,
           adr0_r;

`line 261 "oc8051_sfr.v" 0
reg        wr_bit_r;
reg [2:0]  ram_wr_sel_r;

`line 264 "oc8051_sfr.v" 0
wire [15:0] etr;
wire priv_lvl;

`line 267 "oc8051_sfr.v" 0
wire       p,
           uart_int,
	   tf0,
	   tf1,
	   tr0,
	   tr1,
           rclk,
           tclk,
	   brate2,
	   tc2_int;


`line 279 "oc8051_sfr.v" 0
wire [7:0] b_reg, 
           psw,

`line 282 "oc8051_sfr.v" 0
 
  
	    
	    
	    
	    
	   


`line 291 "oc8051_sfr.v" 0
 
  
	    
	    
	    
	   
	   


`line 300 "oc8051_sfr.v" 0
   
 
            
	    
	   


`line 307 "oc8051_sfr.v" 0
   
	   ie, 
	   tcon, 
	   ip;


`line 313 "oc8051_sfr.v" 0
reg        pres_ow;
reg [3:0]  prescaler;


`line 317 "oc8051_sfr.v" 0
assign cy = psw[7];
assign srcAc = psw [6];

`line 320 "oc8051_sfr.v" 0
wire [7:0] acc_cur, psw_next;


`line 323 "oc8051_sfr.v" 0
 
 
oc8051_acc oc8051_acc1(.clk(clk), 
                       .rst(rst), 
		       .bit_in(bit_in), 
		       .data_in(des_acc),
		       .data2_in(dat2),
		       .wr(we),
		       .wr_bit(wr_bit_r),
		       .wr_sfr(wr_sfr),
		       .wr_addr(adr1),
		       .data_out(acc),
               .data_out_cur(acc_cur),
		       .p(p));



`line 340 "oc8051_sfr.v" 0
 
 
oc8051_b_register oc8051_b_register (.clk(clk),
                                     .rst(rst),
				     .bit_in(bit_in),
				     .data_in(des_acc),
				     .wr(we), 
				     .wr_bit(wr_bit_r), 
				     .wr_addr(adr1),
				     .data_out(b_reg));



`line 353 "oc8051_sfr.v" 0
 
 
oc8051_etr oc8051_etr1 (.clk(clk),
					.rst(rst),
					.wr_bit(wr_bit_r),
					.data_in(dat1),
					.wr(we),
					.wr_addr(adr1),
					.etr(etr),
					.priv_lvl(priv_lvl));


`line 365 "oc8051_sfr.v" 0
 
 
oc8051_sp oc8051_sp1(.clk(clk), 
                     .rst(rst), 
		     .ram_rd_sel(ram_rd_sel), 
		     .ram_wr_sel(ram_wr_sel), 
		     .wr_addr(adr1), 
		     .wr(we), 
		     .wr_bit(wr_bit_r), 
		     .data_in(dat1), 
		     .sp_out(sp), 
		     .sp_w(sp_w));


`line 379 "oc8051_sfr.v" 0
 
 
oc8051_dptr oc8051_dptr1(.clk(clk), 
                         .rst(rst), 
			 .addr(adr1), 
			 .data_in(des_acc),
			 .data2_in(dat2), 
			 .wr(we), 
			 .wr_bit(wr_bit_r),
			 .data_hi(dptr_hi),
			 .data_lo(dptr_lo), 
			 .wr_sfr(wr_sfr));



`line 394 "oc8051_sfr.v" 0
 
 
oc8051_psw oc8051_psw1 (.clk(clk), 
                        .rst(rst), 
			.wr_addr(adr1), 
			.data_in(dat1),
			.wr(we), 
			.wr_bit(wr_bit_r), 
			.data_out(psw), 
			.p(p), 
			.cy_in(bit_in),
			.ac_in(desAc), 
			.ov_in(desOv), 
			.set(psw_set), 
                        .psw_next(psw_next),
			.bank_sel(bank_sel));


`line 412 "oc8051_sfr.v" 0
 
 
 
  oc8051_ports oc8051_ports1(.clk(clk),
                           .rst(rst),
			   .bit_in(bit_in),
			   .data_in(dat1),
			   .wr(we),
			   .wr_bit(wr_bit_r),
			   .wr_addr(adr1),

`line 423 "oc8051_sfr.v" 0
		 
			   .p0_out(p0_out),
			   .p0_in(p0_in),
			   .p0_data(p0_data),
		

`line 429 "oc8051_sfr.v" 0
		 
			   .p1_out(p1_out),
			   .p1_in(p1_in),
			   .p1_data(p1_data),
		

`line 435 "oc8051_sfr.v" 0
		 
			   .p2_out(p2_out),
			   .p2_in(p2_in),
			   .p2_data(p2_data),
		

`line 441 "oc8051_sfr.v" 0
		 
			   .p3_out(p3_out),
			   .p3_in(p3_in),
			   .p3_data(p3_data),
		

`line 447 "oc8051_sfr.v" 0
			   .rmw(rmw));



`line 451 "oc8051_sfr.v" 0
 
 
 
     
                             
			    
			     
			     
			     
			    
			     
			     
		
			    
		
			    
			    
			    
			    
			    
		
			    
			    
			    

`line 476 "oc8051_sfr.v" 0
  assign uart_int = 1'b0;



`line 480 "oc8051_sfr.v" 0
 
 
oc8051_int oc8051_int1 (.clk(clk), 
                        .rst(rst), 
			.wr_addr(adr1), 
			.bit_in(bit_in),
			.ack(int_ack), 
			.data_in(dat1),
			.wr(we), 
			.wr_bit(wr_bit_r),
			.tf0(tf0), 
			.tf1(tf1), 
			.t2_int(tc2_int), 
			.tr0(tr0), 
			.tr1(tr1),
			.ie0(int0), 
			.ie1(int1),
			.uart_int(uart_int),
			.reti(reti),
			.intr(intr),
			.int_vec(int_src),
			.ie(ie),
			.tcon(tcon), 
			.ip(ip));



`line 507 "oc8051_sfr.v" 0
 
 
 
    
                        
		       
		        
		        
		        
		        
		        
		       
		        
		        
		        
		        
		        
		       
		        
		        
		        
		        
		       

`line 531 "oc8051_sfr.v" 0
  assign tf0 = 1'b0;
  assign tf1 = 1'b0;



`line 536 "oc8051_sfr.v" 0
 
 
 
    
                          
			 
			  
			 
			  
			  
			  
			 
			  
			  
			  
			  
			 
			  
			  
			  
			  
			 

`line 559 "oc8051_sfr.v" 0
  assign tc2_int = 1'b0;
  assign rclk    = 1'b0;
  assign tclk    = 1'b0;
  assign brate2  = 1'b0;




`line 567 "oc8051_sfr.v" 0
always @(posedge clk or posedge rst)
  if (rst) begin
    adr0_r <= #1 8'h00;
    ram_wr_sel_r <= #1 3'b000;
    wr_bit_r <= #1 1'b0;
 
  end else begin
    adr0_r <= #1 adr0;
    ram_wr_sel_r <= #1 ram_wr_sel;
    wr_bit_r <= #1 wr_bit;
  end

`line 579 "oc8051_sfr.v" 0
assign comp_wait = !(
                    ((comp_sel==2'b00) &
		       ((wr_sfr==2'b01) |
		        (wr_sfr==2'b10) |
			((adr1==8'he0) & we & !wr_bit_r) |
			((adr1[7:3]==5'b11100) & we & wr_bit_r))) |
		    ((comp_sel==2'b10) &
		       ((|psw_set) |
			((adr1==8'hd0) & we & !wr_bit_r) |
			((adr1[7:3]==5'b11010) & we & wr_bit_r))) |
		    ((comp_sel==2'b11) &
		       ((adr1[7:3]==adr0[7:3]) & (~&adr1[2:0]) &  we & !wr_bit_r) |
		       ((adr1==adr0) & adr1[7] & we & !wr_bit_r)));




`line 596 "oc8051_sfr.v" 0
 
always @(posedge clk or posedge rst)
begin
  if (rst) begin
    dat0 <= #1 8'h00;
    wait_data <= #1 1'b0;
  end else if ((wr_sfr==2'b11) & (adr0==8'h82)) begin				 
    dat0 <= #1 des_acc;
    wait_data <= #1 1'b0;
  end else if (
      (
        ((wr_sfr==2'b01) & (adr0==8'he0)) | 	 
 
        (adr1[7] & (adr1==adr0) & we & !wr_bit_r) |			 
        (adr1[7] & (adr1[7:3]==adr0[7:3]) & (~&adr0[2:0]) &  we & wr_bit_r)  
      ) & !wait_data) begin
    wait_data <= #1 1'b1;

`line 614 "oc8051_sfr.v" 0
  end else if ((
      ((|psw_set) & (adr0==8'hd0)) |
      ((wr_sfr==2'b10) & (adr0==8'he0)) | 	 
      ((wr_sfr==2'b11) & (adr0==8'h83))	 
      ) & !wait_data) begin
    wait_data <= #1 1'b1;

`line 621 "oc8051_sfr.v" 0
  end else begin
    case (adr0) 
      8'he0: 		dat0 <= #1 acc;
      8'hd0: 		dat0 <= #1 psw;

`line 626 "oc8051_sfr.v" 0
 
   
      8'h80: 		dat0 <= #1 p0_data;
  

`line 631 "oc8051_sfr.v" 0
   
      8'h90: 		dat0 <= #1 p1_data;
  

`line 635 "oc8051_sfr.v" 0
   
      8'ha0: 		dat0 <= #1 p2_data;
  

`line 639 "oc8051_sfr.v" 0
   
      8'hb0: 		dat0 <= #1 p3_data;
  


`line 644 "oc8051_sfr.v" 0
      8'h81: 		dat0 <= #1 sp;
      8'hf0: 		dat0 <= #1 b_reg;
      8'h83: 	dat0 <= #1 dptr_hi;
      8'h82: 	dat0 <= #1 dptr_lo;

`line 649 "oc8051_sfr.v" 0
      8'h8e:       dat0 <= #1 etr[7:0];
      8'h8f:       dat0 <= #1 etr[15:8];

`line 652 "oc8051_sfr.v" 0
 
       	   
       	   
       	   


`line 658 "oc8051_sfr.v" 0
 
       		   
       		   
       		   
       		   
       	   


`line 666 "oc8051_sfr.v" 0
      8'hb8: 		dat0 <= #1 ip;
      8'ha8: 		dat0 <= #1 ie;
      8'h88: 	dat0 <= #1 tcon;

`line 670 "oc8051_sfr.v" 0
 
       	   
       	   
          	   
          	   
        	   


`line 678 "oc8051_sfr.v" 0
      default: 			dat0 <= #1 8'h00;
    endcase
    wait_data <= #1 1'b0;
  end
end



`line 686 "oc8051_sfr.v" 0
 

`line 688 "oc8051_sfr.v" 0
wire port_rd = ( adr0[7:3] == 5'b10000 ||
                 adr0[7:3] == 5'b10010 ||
                 adr0[7:3] == 5'b10100 ||
                 adr0[7:3] == 5'b10110 );

`line 693 "oc8051_sfr.v" 0
wire valid_sfr = ( adr0[7:3] == 5'b11100   ||
                   adr0[7:3] == 5'b11010   ||
                   adr0[7:3] == 5'b11110     ||
 
                         
                         
                       

`line 701 "oc8051_sfr.v" 0
 
                       

`line 704 "oc8051_sfr.v" 0
                   port_rd );

`line 706 "oc8051_sfr.v" 0
always @(posedge clk or posedge rst)
begin
  if (rst)
    bit_out <= #1 1'h0;
  else if ((adr1[7:3]==adr0[7:3]) & (~|adr1[2:0]) &  we & !wr_bit_r & (!port_rd | rmw) & valid_sfr)
    bit_out <= #1 dat1[adr0[2:0]];
  else if ((wr_sfr==2'b01) & (adr0[7:3]==5'b11100)) 	 
    bit_out <= #1 acc_cur[adr0[2:0]];
  else if ((adr1==adr0) & we & wr_bit_r & valid_sfr)
    bit_out <= #1 bit_in;
  else
    case (adr0[7:3]) 
      5'b11100:   bit_out <= #1 acc[adr0[2:0]];
      5'b11010:   bit_out <= #1 psw_next[adr0[2:0]];

`line 721 "oc8051_sfr.v" 0
 
   
      5'b10000:    bit_out <= #1 p0_data[adr0[2:0]];
  

`line 726 "oc8051_sfr.v" 0
   
      5'b10010:    bit_out <= #1 p1_data[adr0[2:0]];
  

`line 730 "oc8051_sfr.v" 0
   
      5'b10100:    bit_out <= #1 p2_data[adr0[2:0]];
  

`line 734 "oc8051_sfr.v" 0
   
      5'b10110:    bit_out <= #1 p3_data[adr0[2:0]];
  


`line 739 "oc8051_sfr.v" 0
      5'b11110:     bit_out <= #1 b_reg[adr0[2:0]];
      5'b10111:    bit_out <= #1 ip[adr0[2:0]];
      5'b10101:    bit_out <= #1 ie[adr0[2:0]];
      5'b10001:  bit_out <= #1 tcon[adr0[2:0]];

`line 744 "oc8051_sfr.v" 0
 
           


`line 748 "oc8051_sfr.v" 0
 
          


`line 752 "oc8051_sfr.v" 0
      default:             bit_out <= #1 1'b0;
    endcase
end

`line 756 "oc8051_sfr.v" 0
always @(posedge clk or posedge rst)
begin
  if (rst) begin
    prescaler <= #1 4'h0;
    pres_ow <= #1 1'b0;
  end else if (prescaler==4'b1011) begin
    prescaler <= #1 4'h0;
    pres_ow <= #1 1'b1;
  end else begin
    prescaler <= #1 prescaler + 4'h1;
    pres_ow <= #1 1'b0;
  end
end

`line 770 "oc8051_sfr.v" 0
endmodule

`line 772 "oc8051_sfr.v" 2
